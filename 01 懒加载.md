# 懒加载

## 目录

1 [懒加载](#1)

  - [1.1 需求描述](#1.1)

  - [1.2 代码实现](#1.2)


## <span id="1">一  懒加载 </span>

### <span id="2.1"> 1.1 需求描述 </span>

1 Q: 什么是懒加载功能

A: 懒加载是提高网站性能的一种方式，常用于图片加载

S1 当网页中有多个图片时，不会在进入网站时就加载所有图片(避免响应时间过长)

S2 而是先显示一屏图片

S3 当向下滚动屏幕时，当图片进入了屏幕中，再加载图片，这样就可以提高用户体验


2 Q: 根据需求描述，实现懒加载的 逻辑步骤是什么

A: S1 一开始不会加载图片 + 默认加载首屏图片

S2 监听屏幕的滚动事件: 

S3 当图片到达可视区域时: 加载显示图片


### <span id="1.2"> 1.2 代码实现 </span>

1 Q: 根据逻辑步骤，请写出 懒加载功能的 实现代码

A: S1 实际项目链接可见 [QQ音乐— 懒加载功能](https://github.com/gmYuan/QQ-music/blob/master/scripts/lazyload.js)

S2 实现代码如下

```
function lazyload(images){
  let imgs = [].slice.call(images)   //S1  转化为实际数组
  
  window.addEventListener('scroll', onscroll)  //S2  监听网页滚动事件
  
  function onscroll(){
    if (imgs.length === 0){
      return window.removeEventListener('scroll',onscroll) // 返回且 不再执行下面代码
    }

    imgs = imgs.filter(img => imgs.classList.contains("lazyload"))  // 进一步筛选图片
    imgs.forEach(img => {      // S3 遍历每个图片
      if (inView(img)){    // S4 如果 图片在可视区域内
        loadImage(img)         // S5 就加载图片
      }
    })

  } // 相对 onscroll


  function inView(image){
    let vpWidth = document.documentElement.clientWidth            // 可视区域宽度范围
    let vpHeight = document.documentElement.clientHeight
    let {top, bottom, left, right} = image.getBoundingClientRect()  // 与可视区域的距离值
    return (
      (top > 0 && top < vpHeight || bottom > 0 && bottom < vpHeight) &&
      (left > 0 && left < vpWidth || right > 0 && right < vpWidth)
    ) 
  }

  
  function loadImage(image) {
    let tempImage = new Image()        // 创建一个新的图片对象
    tempImage.src = image.dataset.src
    tempImage.onload = function(){     // 当图片加载好后，就赋值加载真正的 目标图片
      image.src = tempImage.src
      image.classList.remove('lazyload')
    }
  }
}
```



