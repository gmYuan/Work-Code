# 代码显示与效果 同步

## 前言

最近做了一个 代码效果与显示同步 的功能，所以对其做一个小结


目录:

1 [实现思路](#1)

2 [具体代码](#2)


## <span id="1">一 实现思路 </span>

1 Q: 项目结构是什么,都有哪些功能

A: S1 主要分别两部分: 左侧是代码展示+设置样式 同步区， 右侧是个人信息显示区

S2 其中个人信息区显示 要从md语法的文本变成—md格式效果(利用插件)


2 Q: 如何让页面中显示的代码字符串 保留空格和换行格式

A: S1 把插入显示的字符串，放在 `<pre>`的HTML标签内部，该标签可以 保留内部文本内容的 格式


3 Q: 如何实现 一边逐次在页面中显示文字内容，同时 产生其对应样式效果

A: S1 构造 writeCode函数

S2 页面逐次显示文字内容 + 高亮其中CSS代码部分:

&emsp;&emsp;(1) 设定 定时器setInterval 和依次递增(用以截取字符串)的变量n

&emsp;&emsp;(2) 每次定时器循环中，截取子字符串且每轮+1 `string.substring(start, end)`

&emsp;&emsp;(3) 把截取的依次+1字符串 在页面中显示: `container.innerHTML`

&emsp;&emsp;(4) 根据第3方文件(如 prism.js)语法,在插入显示文字后，实现代码高亮

S3 同时产生对应显示效果:

&emsp;&emsp;(1) 创建一个页面的 style标签，把对应的文本内容插入到 style中即可(`style.innerHTML`)


4 Q: 如何创建+显示 个人信息区

A: S1 在显示完 代码显示区后，自动调用一个回调函数（因为代码显示区是 异步程序）

S2 这个回调函数`createPaper`的作用，是创建个人信息区的DOM结构 `div+pre`

S3 个人信息区的样式设置，同样写在第一个result字符串里


5 Q: 如何让代码显示区域跟随书写自动滚动定位

A: S1 让 `code-wrap`的高度，每次新增了样式内容后，就自动刷新变为当前屏幕高度


6 Q: 个人信息区的内容如何显示

A: S1 首先设置要显示的个人信息内容字符串(md语法格式);

S2 在显示代码显示区后，再显示个人内容(通过回调函数的形式)


7 Q: 显示信息后，如何把md语法格式的字符串转化为md文档形式

A: S1 先设置 代码显示区的介绍文字result2 + 调用writeCode函数

S2 html内部 引入 marked.css 和 marked.js

S3 根据 marked.js库的语法, 创建convertHtml函数

S4 在显示完介绍文字result2后，在writeCode里回调 converHtml函数

S5 在default.css里重置marked.js部分的基本样式


8 Q: 转化为md显示后，如何结束

A: 1 创建结束语 result3 + 调用wirteCode函数 显示结束语即可


## <span id="2">二 具体代码 </span>

1 HTML部分

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>会动的简历</title>
  
  <link rel="stylesheet" href="./vendor/prism/prism.css">
  <link rel="stylesheet" href="./css/default.css">
  <style id = "styleTag"></style>
</head>

<body>
  <div id = "code-wrap">
    <pre id = "code"></pre>                     // 2.S1 该标签可以 保留内部文本内容的 格式
  </div>

<script src="./vendor/prism/prism.js"></script>
<script src="js/main.js"></script>
</html>
```

2 CSS部分

```css
*{margin: 0;padding: 0;}
*{box-sizing: border-box;}

.token.selector{
  color: black;
}
.token.property{
  color: black;
}


```


3 JS部分

```js
let $styleTag = document.querySelector('#styleTag')
let $codeContent = document.querySelector('#code')

let result = `/* 
 * 你好，我是Ygm
 * 只用文字做介绍太单调了
 * 我就用代码来介绍吧
 * 首先准备一些样式
 */

*{
  transition: all 1s;
}

html{
  background: #eee;
}
#code{
  border: 1px solid #aaa;
  padding: 16px;
}

/* 我需要一点代码高亮 */
.token.selector{ color: #690; }
.token.property{ color: #905; }

/* 加一个3D效果 */


/* 接下来准备介绍正式内容 */

#code-wrap {
  position: fixed;
  left:0;
  right: 50%;
  top: 0;
  bottom: 0;
}

#paper > .content {
 display: block;
}

/* 开始正式介绍，请看右边 */
`


writeCode('',result, ()=> {
  createPaper()
})


// 以下是封装的 函数部分
function writeCode(precode,newcode,fn) {      // 3.S1 封装函数
  let n = 0
  let timer = setInterval(() => {
    n += 1
    $styleTag.innerHTML = precode + newcode.substring(0,n)  // 3.S3 产生对应显示效果

    // 3.S2 页面逐次显示文字内容 + 代码高亮
    $codeContent.innerHTML = Prism.highlight(precode + newcode.substring(0,n), Prism.languages.css, 'css')

    if (n >= newcode.length){
      clearInterval(timer)
      fn && fn()      // 执行回调函数, 相当于 if (typeof fn === 'function')
    }

  },30)
}

function createPaper(fn2){
  let paper = document.createElement("div")
  paper.id = "paper"
  let content = document.createElement('pre')
  content.className = 'content'

  paper.appendChild(content)
  document.body.appendChild(paper)
  fn2 && fn2.call()
}


```
