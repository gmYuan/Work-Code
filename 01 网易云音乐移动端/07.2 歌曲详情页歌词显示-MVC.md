# 歌曲详情页歌词显示-MVC

目录

1 [获取带时间戳的歌曲歌词](#1)

2 [渲染歌词显示到页面](#2)

3 [根据时间 移动对应时间的歌词显示](#3)


## <span id="1"> 1 获取带时间戳的歌曲歌词 </span>

1 Q: 如何 获取带时间戳的歌曲歌词

A: S0 数据中新增歌词文本 + 存到本地model中

S1 从歌曲网站的xhr请求数据中，获得带有时间戳的歌词文本

S1 后台歌曲上传时 新增歌词多行文本框，并保存到数据库中

S2 歌曲JS文本通过数据库，把歌词信息保存到本地model中


## <span id="2"> 2 渲染歌词显示到页面 </span>

1 Q: 如何实现 渲染歌词显示到页面的功能

A: S0 split方法 + 正则表达式 + data-time自定义属性

S1 获取到歌词字符串，根据\n换行符分隔字符串(形成歌词数组A)

S2 遍历数组A，创建对应 数组成员数量的p标签

S3.1 初步: p标签的文本内容设置为 数组成员(每一行的歌词)

S3.2.0 优化: 为了不显示时间戳 + 以后要根据时间戳判断歌词跳转显示,所以:

S3.2.1 要区分歌词里的时间戳和文本内容: 用正则 + 捕获分组实现

S3.2.2 文本内容作为p的文本内容 + 时间戳作为p的data-time属性

S3.2.3 为了便于之后的歌词文本根据播放时间定位，所以data-time的格式要转化为 秒数

S4 加入到页面歌词容器中，在页面中显示歌词



## <span id="3"> 3 根据时间 移动对应时间的歌词显示 </span>

1 Q: 如何实现 根据时间 移动对应时间的歌词显示

A: S0 

S1 监听播放时的时间改变事件`timeupdate`，获取当前播放的时间

S2.1 遍历所有的歌词文本，获取其data-time属性时间，其上下项 分别和当前播放时间进行比较

S2.2 当 当前时间在两者之间时，通过index遍历下标 确定当前播放的歌词文本行数

S2.3 设置歌词文本行包裹文本的文本行高度为 `文本单行高度(24px) * 行数(index)`



